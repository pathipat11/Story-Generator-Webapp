<!doctype html>
<html lang="th" class="h-full">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="color-scheme" content="light dark" />
    <title>{{ title or "Story Generator" }}</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config = { darkMode: 'class' };</script>

    <!-- Apply theme ASAP -->
    <script>
        (function () {
            const saved = localStorage.getItem("theme");
            const prefersDark = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
            const theme = saved || (prefersDark ? "dark" : "light");
            document.documentElement.classList.toggle("dark", theme === "dark");
        })();
    </script>
</head>

<body class="h-full bg-slate-50 text-slate-900 dark:bg-slate-950 dark:text-slate-100">
    <header
        class="sticky top-0 z-10 border-b border-slate-200/70 bg-white/70 backdrop-blur dark:border-slate-800 dark:bg-slate-950/60">
        <div class="mx-auto flex max-w-6xl items-center justify-between gap-3 px-4 py-3">

            <!-- Brand -->
            <a href="/" class="flex items-center gap-3 shrink-0">
                <div
                    class="h-9 w-9 rounded-xl bg-slate-900 text-white grid place-items-center dark:bg-white dark:text-slate-900">
                    âœ¦
                </div>
                <div class="hidden sm:block">
                    <div class="text-lg font-semibold leading-tight">Story Generator</div>
                    <div class="text-xs text-slate-500 dark:text-slate-400">Gemini â€¢ Story â€¢ Chapters â€¢ Anime</div>
                </div>
            </a>

            <!-- Nav -->
            <nav class="flex items-center gap-2">
                {% set p = request.url.path %}
                {% set link_base = "rounded-xl px-3 py-2 text-sm font-medium transition" %}
                {% set link_active = "bg-slate-900 text-white dark:bg-white dark:text-slate-900" %}
                {% set link_idle = "text-slate-700 hover:bg-slate-100 dark:text-slate-200 dark:hover:bg-slate-900" %}

                <a href="/" class="{{ link_base }} {{ link_active if p == '/' else link_idle }}">
                    Home
                </a>
                <a href="/create" class="{{ link_base }} {{ link_active if p.startswith('/create') else link_idle }}">
                    Create
                </a>
                <a href="/stories" class="{{ link_base }} {{ link_active if p.startswith('/stories') else link_idle }}">
                    Stories
                </a>
            </nav>

            <!-- Right -->
            <div class="flex items-center gap-2 shrink-0">
                {% block header_right %}{% endblock %}
                <button id="themeToggle"
                    class="inline-flex items-center gap-2 rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-medium text-slate-700 shadow-sm hover:bg-slate-50 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-800">
                    <span id="themeIcon">ðŸŒ™</span>
                    <span class="hidden sm:inline">Theme</span>
                </button>
            </div>
        </div>
    </header>

    <main class="mx-auto max-w-6xl px-4 py-6">
        {% block content %}{% endblock %}
    </main>

    <!-- Theme toggle script -->
    <script>
        const themeToggle = document.getElementById("themeToggle");
        const themeIcon = document.getElementById("themeIcon");

        function applyThemeIcon() {
            const isDark = document.documentElement.classList.contains("dark");
            themeIcon.textContent = isDark ? "â˜€ï¸" : "ðŸŒ™";
        }

        applyThemeIcon();

        themeToggle.addEventListener("click", () => {
            const isDark = document.documentElement.classList.toggle("dark");
            localStorage.setItem("theme", isDark ? "dark" : "light");
            applyThemeIcon();
        });
    </script>

    {% block scripts %}{% endblock %}
</body>

</html>